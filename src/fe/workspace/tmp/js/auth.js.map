{"version":3,"sources":["../../js/auth.js"],"names":[],"mappings":";;;;;;AAEA,IAAI,aAAa,GAAG,EAAE,CAAA;;AAEtB,IAAM,IAAI,GAAG,CAAC,UAAC,CAAC,EAAK;;AAEnB,MAAM,aAAa,GAAG,oBAAoB,CAAA;AAC1C,MAAM,UAAU,GAAG,wCAAwC,CAAA;AAC3D,MAAM,iBAAiB,GAAG,+CAA+C,CAAA;;MAEnE,IAAI;AACG,aADP,IAAI,GACM;4BADV,IAAI;KAGP;;;;iBAHG,IAAI;;aAMa,+BAAC,QAAQ,EAAmB;YAAjB,YAAY,yDAAC,EAAE;;AAC7C,YAAI,IAAI,GAAG,IAAI,CAAA;;AAEf,YAAI,CAAC,GAAG,CACN,aAAa,EACb,EAAE,EACF,IAAI;;AAEJ,kBAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAK;AAC3B,kBAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;SAC7B;;AAED,kBAAC,KAAK,EAAE,UAAU,EAAE,WAAW,EAAK;AAClC,iBAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;AACnB,iBAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;;AAElB,gBAAM,CAAC,QAAQ,CAAC,IAAI,QAAM,UAAU,GAAG,iBAAiB,AAAE,CAAA;SAC3D,CACF,CAAA;OACF;;;aAEgB,2BAAC,EAAE,EAAE;AACpB,YAAI,aAAa,CAAC,EAAE,CAAC,KAAK,SAAS,EAAE;AACnC,iBAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAA;AAClC,iBAAO,aAAa,CAAC,EAAE,CAAC,CAAA;SACzB;AACD,eAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAA;AACrC,YAAI,MAAM,GAAG,EAAE,CAAA;AACf,YAAI,CAAC,GAAG,CACN,qBAAqB,GAAG,GAAG,GAAG,EAAE,EAChC,EAAE,EACF,KAAK;;AAEL,kBAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAK;AAC3B,gBAAM,GAAM,KAAK,CAAC,YAAY,CAAC,IAAI,SAAI,KAAK,CAAC,YAAY,CAAC,EAAE,AAAE,CAAA;AAC9D,uBAAa,CAAC,EAAE,CAAC,GAAG,MAAM,CAAA;SAC3B;;AAED,kBAAC,KAAK,EAAE,UAAU,EAAE,WAAW,EAAG;AAChC,gBAAM,GAAG,EAAE,CAAA;SACZ,CACF,CAAA;AACD,eAAO,MAAM,CAAA;OACd;;;WAjDG,IAAI;;;AAoDV,SAAO,IAAI,CAAA;CAEZ,CAAA,CAAE,MAAM,CAAC,CAAA","file":"auth.js","sourcesContent":["import Ajax from './Ajax'\n\nvar userInfoCache = {}\n\nconst Auth = (($) => {\n\n  const USER_INFO_URL = '/v2/ajax/auth/info'\n  const LOGIN_PAGE = 'http://sso.pinganfu.net/login?referer='\n  const ACHAIN_VALIDATION = \"http://achain.pinganfu.net/ssovalidation.html\"\n\n  class Auth {\n    constructor() {\n\n    }\n\n    // 获取当前用户信息\n    get_current_user_info(callback, current_path=\"\") {\n      var that = this\n      //console.log('get_current_user_info')\n      Ajax.get(\n        USER_INFO_URL,\n        {},\n        true,\n        // success\n        (data, textStatus, jqXHR) => {\n          callback(jqXHR.responseJSON)\n        },\n        // error\n        (jqXHR, textStatus, errorThrown) => {\n          console.log('登陆失败')\n          console.log(jqXHR)\n          // 登陆失败则获取跳转页面地址\n          window.location.href = `${LOGIN_PAGE}${ACHAIN_VALIDATION}`\n        }\n      )\n    }\n\n    get_user_id_by_um(um) {\n      if (userInfoCache[um] !== undefined) {\n        console.log(\"use user info cache\")\n        return userInfoCache[um]\n      }\n      console.log(\"get user info from sso\")\n      var result = um\n      Ajax.get(\n        USER_DETAIL_BY_UM_URL + '/' + um,\n        {},\n        false,\n        // success\n        (data, textStatus, jqXHR) => {\n          result = `${jqXHR.responseJSON.name}/${jqXHR.responseJSON.um}`\n          userInfoCache[um] = result\n        },\n        // error\n        (jqXHR, textStatus, errorThrown)=>{\n          result = um\n        }\n      )\n      return result\n    }\n  }\n\n  return Auth\n\n})(jQuery)\n\nexport default Auth\n"]}